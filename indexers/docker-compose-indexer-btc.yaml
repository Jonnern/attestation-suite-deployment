

services:
  indexer:
    image: flarefoundation/attestation-client
    volumes:
      - ../credentials.prepared/btc-indexer-verifier:/app/attestation-suite-config
    container_name: indexer-btc-indexer
    command: indexer btc
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: test123
      TESTNET: ${TESTNET}
    depends_on:
      - database

  verification-server:
    image: flarefoundation/attestation-client
    volumes:
      - ../credentials.prepared/btc-indexer-verifier:/app/attestation-suite-config
    container_name: indexer-btc-verification-server
    command: verification-server
    restart: unless-stopped
    environment:
      VERIFIER_TYPE: btc
      APP_BASE_PATH: /verifier/btc
      MYSQL_ROOT_PASSWORD: test123
      TESTNET: ${TESTNET}
    depends_on:
      - database
    ports:
      - 9500:9500

  database:
    image: mysql:8-debian
    container_name: indexer-btc-database
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: test123
    cap_add:
      - SYS_NICE
    ports:
      - 127.0.0.1:23306:3306
    volumes:
    #   - ./mysql-conf.d/:/etc/mysql/conf.d
    #   - ./mysql-initdb/:/docker-entrypoint-initdb.d
      - indexer-btc-db:/var/lib/mysql

  spammer:
    image: flarefoundation/attestation-client
    profiles: ["spammer"]
    volumes:
      - ../credentials.prepared/btc-indexer-verifier:/app/attestation-suite-config
    container_name: indexer-btc-spammer
    command: spammer BTC 10000
    restart: unless-stopped
    environment:
      TESTNET: ${TESTNET}

volumes:
  indexer-btc-db:
